<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-slider/paper-slider.html">

<link rel="import" href="bower_components/mapbox-gl/mapbox-gl.html">
<link rel="import" href="bower_components/mapbox-gl/mapbox-layer.html">
<link rel="import" href="bower_components/mapbox-gl/geojson-source.html">

<dom-module id="test-mapbox">
  <template>
    <style is="custom-style" include="demo-pages-shared-styles">
      mapbox-gl {
        height: 400px;
        width: 100%;
      }
    </style>
    <mapbox-gl
      interactive
      access-token="[[key]]"
      map="{{map}}"
      zoom="7"
      latitude="19.7567"
      longitude="-100.3718"
      ></mapbox-gl>

    <template is="dom-repeat" items="[[layers]]">
      <mapbox-layer
        map="[[map]]"
        layer-id="[[item.id]]"
        rendering-type="[[item.type]]"
        source="[[item.source]]"
        color="[[item.color]]"
        opacity="0.7"
        events-to-watch="click"
        on-mapbox-layer-click="_handleClick"
        ></mapbox-layer>


      <geojson-source
        map="[[map]]"
        source-id="[[item.source]]"
        source-data="[[item.data]]"></geojson-source>
    </template>
  </template>

  <script>
    /**
     * `test-mapbox`
     *
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class TestMapbox extends Polymer.Element {
      static get is() { return 'test-mapbox'; }
      static get properties() {
        return {
          key: {
            type: String,
            value: 'pk.eyJ1IjoiZXRlcm5hMiIsImEiOiJjaXppZjRoaTIwMmYxMndsNHJ4dzR1eWJsIn0.MvJ5fsV47RHlSAt2fBEKLg'
          }
        };
      }

      _handleClick (e) {
        let bbox = this._getBboxForGeoJsonPolygon(e.detail.features[0].geometry)
        this.map.fitBounds(bbox, {padding: 20})
      }

      _getBboxForGeoJsonPolygon(geometry) {
        let coordinates = geometry.coordinates
        let bounds = new mapboxgl.LngLatBounds(coordinates[0][0], coordinates[0][0])
        console.log('old',bounds)
        coordinates[0].forEach(function(i,e){
          bounds.extend(i)
        })
        return bounds
      }

      ready () {
        super.ready()
        setTimeout(() => {
          this.set('layers', [
            {
              id: 'layer1',
              type: 'fill',
              color: '#faa',
              source: 'source1',
              data: {
                type: 'FeatureCollection',
                features: [
                  {
                    geometry:
                      {
                        type:'Polygon',
                        coordinates:
                          [[[-98.9789944237595,19.0744496805977],[-98.9835905287763,19.0787598984935],[-99.028981027977,19.0853616246376],[-99.0432131048912,19.0757591138825],[-99.0597907802277,19.0482428283285],[-99.1254358387783,19.0620646241124],[-99.1364664908187,19.089380857359],[-99.2267720300803,19.0960553297968],[-99.2786921681324,19.1317010136606],[-99.2875991026823,19.1465958172751],[-99.3027504005998,19.1908619369304],[-99.3071246246848,19.213722459694],[-99.3162534401665,19.2215063131092],[-99.3153342191631,19.2291992336573],[-99.3423402982965,19.2411296258077],[-99.3391705706987,19.2677002095449],[-99.3482042943524,19.2739563907945],[-99.3649087587929,19.2777755712084],[-99.3499793418072,19.2968351001315],[-99.3566040724866,19.3066740363409],[-99.3338454283343,19.3305893803617],[-99.328488588694,19.3530861716574],[-99.3130837125687,19.3704543492543],[-99.3013240231808,19.3770924485452],[-99.3012289313529,19.3697086997449],[-99.2695633526507,19.3903868337005],[-99.2650623394619,19.3989527097719],[-99.2369151583933,19.4127017592622],[-99.2244581289339,19.4270873388215],[-99.2278497374636,19.4385630666368],[-99.2068344434901,19.4712079658896],[-99.2211299149562,19.4750635194504],[-99.2101626574678,19.5111456810758],[-99.2046790287236,19.5151285406504],[-99.1770390040707,19.506198933111],[-99.1571965093084,19.5028526036054],[-99.1629654135364,19.5179656461008],[-99.1746300110964,19.5240581481897],[-99.1760246912394,19.5320420539123],[-99.159161740419,19.5268952536401],[-99.1510789350446,19.5448454015858],[-99.1609050905978,19.549264738922],[-99.1337722223606,19.5862380426439],[-99.1178918870956,19.5905846336865],[-99.1080974288183,19.5648870054725],[-99.1305707974868,19.5360976597804],[-99.125911297918,19.5212028561659],[-99.114405186738,19.5110547482088],[-99.0973837495377,19.5126369800946],[-99.0638480315529,19.4987788111639],[-99.0679369801541,19.4891763004087],[-99.0464462270409,19.4423640604774],[-99.0551946752109,19.4242684199445],[-99.0581425218768,19.4006986208183],[-99.0195669370115,19.3832576969278],[-98.9919269123586,19.3675990572305],[-98.9945577862648,19.3581420390625],[-98.9579157352341,19.3232238181348],[-98.9672347343717,19.3059647599783],[-98.9765220362332,19.2531327642516],[-98.9659985406085,19.2499319273332],[-98.9685977172387,19.2322182048417],[-98.9402920497903,19.2232340375822],[-98.9425425563847,19.2156138633276],[-98.9683758363069,19.2104852496289],[-98.9676784962354,19.1897343693796],[-98.9524004092139,19.1686379442357],[-98.9673615234756,19.1644368457803],[-98.9546192185324,19.1495238555924],[-98.9664423024722,19.1438678312651],[-98.9575036706464,19.1223894880798],[-98.9590568371693,19.1042756609735],[-98.9657132651247,19.0858526621194],[-98.9789944237595,19.0744496805977]]]},
                        type:'Feature',
                        properties:{
                          cvegeo:'48409',
                          id:9,
                          name:'Distrito Federal'
                        },
                        from:'cdmx'
                    }
                ]
              }
            },
            {
              id: 'layer2',
              type: 'fill',
              color: '#ffa',
              source: 'source2',
              data: {
                type: 'FeatureCollection',
                features: [
                  {
                    geometry:
                      {
                        type:"Polygon",coordinates:[[[-98.9789944237595,19.0744496805977],[-98.9577889461302,19.0603005264926],[-98.9443493011155,19.0697393580871],[-98.9155998718033,19.0640651471864],[-98.9170579464983,19.0594275709694],[-98.9033964205518,19.0384766384127],[-98.8881817280823,19.0369125931003],[-98.8710335017781,19.0254004921382],[-98.874044742996,19.0103965690833],[-98.8688780870116,19.0057044331461],[-98.8700191889468,18.9905186443572],[-98.8573402785556,18.9745872060589],[-98.8594639960461,18.9647846429964],[-98.8358812227184,18.9501444514095],[-98.8264354344769,18.9566916178334],[-98.8168628571316,18.9432699266643],[-98.7920755873167,18.935340580662],[-98.7861164994328,18.9429061951963],[-98.7630725797967,18.9403964480671],[-98.7333405349293,18.9457069274999],[-98.714829325758,18.9426515831687],[-98.6909295796706,18.9675671887266],[-98.6644623542289,19.0035584174849],[-98.6521955084253,19.0059954183205],[-98.6329552619066,19.0155433693555],[-98.6503253691426,18.9980478857448],[-98.6633212522936,18.9625113213214],[-98.6762854381687,18.9446521062427],[-98.6780921828994,18.9237193602594],[-98.7073487686272,18.9028593605698],[-98.7056688130004,18.8907834758322],[-98.7141636829625,18.8752157690019],[-98.713466342891,18.8672500498528],[-98.697490915798,18.8778164489981],[-98.7029428472663,18.8897468411485],[-98.672925526915,18.9094429001405],[-98.661419415735,18.8982217843528],[-98.6792015875587,18.8760705379517],[-98.6871576038292,18.8576839122445],[-98.7027209663344,18.8394609656978],[-98.7070000985915,18.8224019598487],[-98.7169847405246,18.8105443139919],[-98.7280153925649,18.8052338345592],[-98.7296953481918,18.7914120387753],[-98.7397116874009,18.7668783512588],[-98.7535000024513,18.742963007238],[-98.7386656772936,18.7371614903234],[-98.7289346135683,18.7452363289129],[-98.7159070331413,18.7391983865442],[-98.7239898385157,18.7190658497905],[-98.7418354048914,18.7029525457582],[-98.7327065894097,18.6737812820248],[-98.7199008899146,18.6559584400929],[-98.7135614347189,18.6063090947112],[-98.7198691926386,18.6002347791956],[-98.7125788191636,18.5879588421507],[-98.7166677677648,18.5659167151901],[-98.7060174830361,18.5527314494751],[-98.7031647281981,18.5397826092144],[-98.7127056082675,18.5179587211346],[-98.7043058301333,18.5040823656304],[-98.7073170713512,18.4928430632693],[-98.6990757795969,18.4910789656495],[-98.7104234043971,18.4680729502987],[-98.7067148231077,18.4451033080946],[-98.7300440182275,18.4404475453042],[-98.738095126326,18.4557424535335],[-98.7476043091194,18.4514322356378],[-98.7560040872536,18.4577975363277],[-98.758286291124,18.4725286607816],[-98.7984784370643,18.4976988783671],[-98.8124252384946,18.5203411622499],[-98.8345499371273,18.5211777446263],[-98.8403505386313,18.5127755477156],[-98.836451773686,18.4945707877423],[-98.8445662763364,18.4899695846721],[-98.8501766941845,18.4782392448292],[-98.8651061111702,18.4797487304214],[-98.9145221644201,18.4588705441583],[-98.9149659262838,18.4414296202678],[-98.9193084530928,18.4319726020999],[-98.9506253617591,18.417696141981],[-98.973954556879,18.4171323582056],[-98.9853655762311,18.421151590927],[-98.9852070898512,18.4070751831154],[-98.9906273240435,18.3947628729237],[-99.0009289387364,18.3882520796466],[-99.0183624405243,18.387451870417],[-99.0205178552908,18.3770127772854],[-99.0485382472555,18.3512424027778],[-99.0587764673964,18.3488599616624],[-99.0576987600131,18.3384572416777],[-99.0659717490434,18.3325647918961],[-99.0755126291128,18.3399667272699],[-99.0660351435954,18.3671010947825],[-99.0741496462458,18.3774856281938],[-99.0798551559218,18.3726116265227],[-99.0785238703308,18.3870699523756],[-99.0895545223711,18.3999824194895],[-99.1005217798595,18.4011827333339],[-99.1084777961301,18.416332148976],[-99.1271791889571,18.4259528463045],[-99.1295881819315,18.4408294633456],[-99.1363713989908,18.4501409889264],[-99.1339624060165,18.4573246854193],[-99.149113703934,18.4674364202297],[-99.160714906942,18.4641264638709],[-99.1813181363277,18.4484132644534],[-99.1778948305221,18.4247525324601],[-99.2066759571102,18.4474311894898],[-99.2054080660711,18.4565972224833],[-99.246012276599,18.4564335433227],[-99.2475971403979,18.4509957578762],[-99.2801502428274,18.454578512836],[-99.3042401725708,18.4594707010805],[-99.3121644915653,18.4547785651434],[-99.3283617995901,18.4595434473741],[-99.3282667077622,18.4888238305479],[-99.3455417231703,18.4822948506974],[-99.3526736102653,18.4859867250976],[-99.3434497029557,18.4671272484819],[-99.3573965043861,18.4676728456839],[-99.3550509059637,18.476729759237],[-99.3642431159973,18.4851501427212],[-99.3629435276822,18.4990264982253],[-99.379204230259,18.5205230279839],[-99.3902665795754,18.5256880148295],[-99.4077951731912,18.5560595924073],[-99.4228830765568,18.5620611616293],[-99.4252920695312,18.5791201674784],[-99.419713348959,18.5903412832661],[-99.4293810181323,18.5889227305409],[-99.4405067620006,18.5974704200389],[-99.4405384592766,18.6120924250524],[-99.4538830124634,18.6099100362444],[-99.460222467659,18.6381901578812],[-99.477560877619,18.673563043144],[-99.4842490028504,18.6984604621284],[-99.4944238284394,18.7205389622359],[-99.4661815555429,18.7537658318375],[-99.4633288007049,18.7671875230066],[-99.4509668630734,18.7725161890128],[-99.4258943177747,18.8264393791434],[-99.4301100554798,18.832604627526],[-99.4322654702463,18.8578112182582],[-99.4293493208563,18.8775618369705],[-99.4109649007891,18.8781801804661],[-99.406654071256,18.895184626595],[-99.364750272413,18.899003807009],[-99.3391388734227,18.9265382791364],[-99.3379026796595,18.9323943557712],[-99.3171726611698,18.9399963434523],[-99.3106113250424,18.956855296994],[-99.3110550869061,18.991646211908],[-99.3084559102759,18.99401046645],[-99.3196767459721,19.0112695246065],[-99.3117524269776,19.0246548426288],[-99.3189160113486,19.031074703039],[-99.3174896339296,19.0401316165921],[-99.3085826993798,19.0402952957527],[-99.3191061950045,19.0606460713872],[-99.3183137631051,19.0874167074318],[-99.3137493553642,19.0982195320314],[-99.2950796598131,19.1229350852818],[-99.2786921681324,19.1317010136606],[-99.2267720300803,19.0960553297968],[-99.1364664908187,19.089380857359],[-99.1254358387783,19.0620646241124],[-99.0597907802277,19.0482428283285],[-99.0432131048912,19.0757591138825],[-99.028981027977,19.0853616246376],[-98.9835905287763,19.0787598984935],[-98.9789944237595,19.0744496805977]]]},
                    type:"Feature",
                    properties:{
                      cvegeo:"48417",
                      id:17,
                      name:"Morelos"
                    },
                    from:"morelos"
                  }
                ]
              }
            }
          ])
        }, 500)
      }
    }

    window.customElements.define(TestMapbox.is, TestMapbox);
  </script>
</dom-module>
